---
title: 02.仕様書
source:
author:
  -
published:
created: 2026-01-24
description:
tags:
---


# 基本仕様

- SPA
	- ログイン、モード切替やごみ箱を閲覧した場合、内部的に投稿をキャッシュで切り替えて表示する設計とする。URLパラーメータにて画面を切り替える
- ブラウザ
	- 以下を対象とする
		- PC用Webブラウザ（Chrome, Firefox, Safari, Edge の最新版）
		- スマートフォン用Webブラウザ（iOS Safari, Android Chrome の最新版）
- スマートフォンのホーム画面追加
	- manifest.jsonを実装する
		- name/short_name: アプリ名（例: Mono Log）
		- id/start_url/scope: SPAの起点（ログイン前でも開けるURLにする）
		- display: standalone（アプリっぽく起動）
		- theme_color/background_color: スプラッシュ/ブラウザUI色（デザインに合わせて決め打ち）
		- icons: 192/512 + maskable（Androidで重要）
- デザイン・レイアウト
	- 画面のレイアウトは別途資料（miro）を参照し、スマートフォン相当とPC画面相当のレイアウトで実装する。

---

# ログイン

- ボタン押下でログイン用モーダルウィンドウを表示する
- モーダル内に「Googleでログイン」ボタンを表示する
- ログインボタンを押下すると認証処理を実行する。成功したら、未ログイン用のウェルカムメッセージ／ログインボタンを非表示にし、ログイン中画面に表示を切り替える
- モーダルの右上のバツボタンを押下するとモーダルが解除される
- 認証に失敗した場合はエラー通知（トースト）を表示し、モーダルは開いたままにする（リトライ可能）

---

# ユーザーアイコン

- ログアウト機能
	- アイコンを押下するとポップオーバーが開き、ユーザー名と「ログアウト」を表示する
	- ユーザーアイコンまたはポップオーバー以外のエリアをクリックすると閉じる
	- 「ログアウト」リンクを押下するとログアウトする
		- ログアウト成功時: URL パラメータを全削除して `/` に戻し、未ログイン画面へフェードインで切り替える（ログアウト専用画面は作らない）
		- ログアウト失敗時: エラー通知（トースト）を表示し、未ログイン画面へは切り替えない（リトライ可能）
- 将来的にユーザー固有機能の設定を追加予定（内容未定）

---

# 表示切り替え

- 構成要素
	- トグルボタン（メモ/ノート）
	- 「ごみ箱を見る」テキストボタン
- 各モードとごみ箱は URL クエリで判定し、ブラウザでの進む/戻るで状態を保存できるようにする

---

# タグ（共通仕様）

- タグ入力は `label`（タグ名）を入力する（`tagId` をユーザーに入力させない）
- 保存時の `label` ルール（正規化）
	- 前後空白は削除される
	- 連続する空白/改行/タブはスペース1つに正規化される
	- 全角/半角の揺れは可能な範囲で正規化される
- バリデーション（正規化後）
	- 空は不可
	- 最大 32 文字
	- 不正な場合は Alert で通知し、入力状態は維持する
- 大小文字は区別する（案A）。例: `React` と `react` は別タグ
- タグ絞り込み状態は URL に反映される
		- 複数タグがアクティブな場合は OR 条件（選択タグのいずれかを含む投稿を表示する）
		- URL には `label` ではなく内部識別子（`tagId`）が載る（詳細は設計書「タグの識別子（tagId / label）」を参照）
- `view=trash`（ごみ箱表示）中は、タグ絞り込み/お気に入り絞り込み UI は **非表示** とする（URL 上の `tags` / `favorite` の値は保持する）

---

# 投稿エディタ

- テキスト入力
	- 現在アクティブなモードによって出し分ける
		- メモ用
			- 一行テキスト（短文）を入力する想定のinputフィールドを設置
		- ノート用
			- 長文を入力する想定のリッチテキストエディタを設置する
			- マークダウン風のショートカット入力（例: `#` で見出し、`- [ ]` でタスク等）を許可する
	- 投稿のモードは URL パラメータで識別し、**作成後は変更できない**
    - クリアボタン
	    - 押下すると入力した内容が消える
	- 保存ボタン
	    - 保存の際は、現在アクティブなモードが設定される（モードはURLパラメーターで識別する）
	    - 押下すると投稿内容、タグ、モード、日時が保存される
	    - 保存完了後は以下の状態にする
        - エディタの入力内容をクリアする
        - 再びエディタにフォーカスを当てる
	        - 「保存しました」または「更新しました」といったフィードバックメッセージを表示する
		    - エディタが空の場合は保存を行わず、Alertで未入力であることを通知する
	- タグボタン
		- タグの入力ルールは「タグ（共通仕様）」に従う
		- 押下すると、タグ入力、タグUIがアコーディオンUIが開く形で表示される
			- タグクラウド
				- 既存のタグがボタンで表示される
				- 投稿にタグがセットされる前はグレー
				- 押下するとタグが選択状態となり色が濃くなる
			- タグ入力テキストフィールド
				- タグの入力ができる
				- タグのサジェストで既存タグをセットできる
					- 入力されたタグやタグボタンで押下したタグがテキストとしてセットされる
					- セットされたタグが既存のタグなら、一致するタグボタンが消える
				- テキストをクリックまたはタップするとテキストフィールドから消える
					- 既存のタグならタグボタンが復活する
				- 入力されたタグが既存タグではない新規タグの場合、投稿保存ボタン押下時にDBに即座に保存され、タグボタンに即時反映される

- **既存投稿の編集**
	- キャンセルボタン
		- 既存投稿の編集時のみ表示する
		- 押下すると編集状態から通常表示に戻る
	- 投稿のモードは変更できない（編集時も固定）
	- 編集中の離脱（未保存変更あり）
		- `hasEdits`：編集開始時点の内容と比べて、未保存の変更がある状態
		- `hasEdits=true` のときに以下の操作を行う場合は確認を表示する
			- モード切替 / タグ絞り込み / お気に入り絞り込み / ごみ箱表示切替など、URLパラメータが変わる操作
			- 他の投稿の編集を開始する操作
			- ブラウザの戻る/進む、リロード、タブを閉じる
		- 確認の選択肢
			- 「破棄して続行」：編集を破棄して操作を実行する
			- 「編集を続ける」：操作をキャンセルし、編集状態を維持する
				- URLパラメータが変わる操作の場合、URL変更も取り消し（元のURLに戻す）編集状態を維持する


---

# 投稿一覧

- **投稿一覧の仕様**
	- 現在アクティブになっているモードの一覧を表示する
		- デフォルトのモードはメモ
		- アクティブの判定はURLパラメーターによって判定される。これはモード切り替えUIの操作によって自動的にパラメータが付与・変更される
	- 投稿を立て一列で並べるシンプルなレイアウトで表示する
	- 直近n件を表示する（初期値は10アイテム）
	- 投稿の並び順の初期値は投稿作成日時の降順（新しいものが上）
- **取得した投稿一覧はキャッシュする**
	- モードを切り替え、ごみ箱を表示、投稿取得などの操作はキャッシュされ、表示を切り替えたりブラウザの進む/戻るボタンを押下しても取得済みの投稿、スクロール位置は維持される
- **タグ絞り込み/お気に入り絞り込み時は再取得**
	- キャッシュしない理由：表示中に投稿を編集し、「スターを脱着」、「タグを付け替え」などの操作をしたときに、現在の一覧から削除、別のキャッシュに投稿を挿入する実装コストより、再取得する方操作コストの方が低い、且つユーザーのUXに大きく影響はなさそう、と判断した。
		- **投稿検索**
			- `view=trash`（ごみ箱表示）中は、お気に入り絞り込みトグル/タグクラウドの UI は **非表示** とする（URL 上の `tags` / `favorite` の値は保持する）
			- お気に入り絞り込みトグル（shadcn/ui Toggle）
				- ON にするとお気に入り（スター）フラグがついた投稿のみを取得する（URL に `favorite=1` を付与）
				- OFF にすると URL から `favorite` を削除する
				- 画面のレイアウトとしては、タグクラウドの中のボタンの一つとして表示する
				- タグ絞り込みと併用できる（併用時は両方の条件を満たす投稿のみ表示する）
		- タグクラウド
			- タグボタンを表示する
				- ユーザーごとに異なるタグクラウドを保有する
			- タグボタンを押下するとタグボタンがアクティブになり、タグに該当する投稿一覧を表示する
				- アクティブにできるタグは複数
				- 複数タグがアクティブな場合は OR 条件（選択タグのいずれかを含む投稿を表示する）
			- アクティブなタグボタンを押下すると、非アクティブになり、そのタグの絞り込みが解除される
				- すべてのタグが非アクティブになった場合、タグ絞り込みは解除される

# 投稿一覧 個別の内容

- 各投稿の表示要素
		- 所属するモード（メモ／ノート）
	    - 作成日（投稿日）
	    - 更新日
	    - 投稿本文
			- メモ（`mode=memo`）: **全文表示**（省略しない）
				- 入力は1行だが、一覧では全文を表示する（1行想定）
			- ノート（`mode=note`）: **最大10行まで表示**
				- 10行を超える場合は「もっと見る / 折りたたむ」で開閉できる
				- 初期状態は折りたたみ（10行まで表示）
	    - ごみ箱アイコン（削除）
		    - 投稿をごみ箱に移動するためのボタン。押下すると投稿一覧からは非表示になる
	    - 編集ボタン
			- 押下すると、その投稿の表示領域をエディタに差し替える。
			- 差し替わったエディタ内にはその投稿の内容が表示され、編集可能状態になっている。
	- スター（お気に入り）ボタン
		- 星マークで表現する
		- 用途：モード切替のときのサブオプション
		- 押下するとスターがグレーからイエローに変化する
		- イエローのときに押下するとグレーに戻る

# 投稿の自動取得（無限スクロール）

- 投稿一覧が表示されているページをスクロールし最下部に到達したとき、次のn件を自動的に取得開始する。
- 取得を待っている間はスケルトンUIを表示する。

---
# ごみ箱

- このアプリにおける「削除」は **ごみ箱に移動** を指す
- ごみ箱に移動された投稿は一覧で表示される
- ごみ箱から通常の投稿に戻すことが可能
- ごみ箱内で「完全に削除」を実行すると**復元することができなくなる**(DBから削除する想定)
- ごみ箱表示画面では、通常の投稿一覧と同じレイアウトの一覧コンポーネントを利用する
- タグ・お気に入りの検索UIは非表示（URL 上の `tags` / `favorite` の値は保持する）
- ごみ箱内の投稿個別にチェックを脱着する機能がある
- ごみ箱内の投稿すべてに一括でチェックを脱着する機能がある
- チェックを付けた投稿に対して以下のアクションができる
	- チェックが付いてる投稿の数を表示する
		- チェックの脱着に追随して表示する
		- チェックを付けた投稿を完全削除する

## 投稿の完全削除

- 削除確認モーダル
	- 確認メッセージ（例：n件の投稿を完全に削除しますか?）
	- 警告メッセージ（この操作は取り消せません）
	- キャンセルボタン：モーダルを閉じる
	- 削除ボタン：対象の投稿を完全に削除し、成功通知を表示する
	  - 失敗した場合はエラー通知（トースト）を表示し、再試行できる導線を提供する（状態維持）
	  - 本モーダルは一括削除（複数選択削除／ごみ箱を空にする）でのみ使用する

---

# エラーハンドリング

- 各種アクション、認証・通信エラー時に必要なフィードバックを適切表示する
  - ログイン（OAuth）失敗: トースト表示、モーダルは開いたまま（再試行可能）
  - ログイン必須操作で 401: トースト表示＋入力維持のままログインモーダル自動表示
  - 403/404: トースト表示、状態維持（必要なら再取得）
  - 詳細は `docs/03.設計書.md`「エラー通知実装設計」を参照

---

# セキュリティ

- Google OAuth による安全な認証
- XSS・SQLインジェクション対策
- 認証・認可エラー時に内部情報を漏洩しない


---

# パフォーマンス

- データベースのパフォーマンスやregionの選定、ReactフックやReact Compilerなどのデータ保持の工夫、TanStack Queryのキャッシュ、スケルトンUIなどを活用
