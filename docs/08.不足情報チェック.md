---
title: 08.不足情報チェック（実装観点）
source:
author:
  -
published:
created: 2026-01-25
description:
tags:
---

# 目的

`docs/01.要件定義書.md` → `docs/02.仕様書.md` → `docs/03.設計書.md` を突き合わせ、実装に必要だが **未決・不足・矛盾** している情報を棚卸しする。

# 対象

- 要件: `docs/01.要件定義書.md`
- 仕様: `docs/02.仕様書.md`
- 設計: `docs/03.設計書.md`

# 不足情報・矛盾一覧（優先度順）

| ID      | 修正状況  | 領域                      | 参照（現状）                                                                                                   | 不足/矛盾                                                      | 追記・修正の提案（決めること）                                                                              | 優先度    | メモ                               | 修正結果                                                                                                                                                                                                                               |
| ------- | ----- | ----------------------- | -------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------- | -------------------------------------------------------------------------------------------- | ------ | -------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| GAP-001 | - [済] | 投稿本文/エディタ               | 01/02: ノート=リッチテキスト（tiptap、マークダウン風ショートカット入力） / 03: tiptap + JSON保存                                        | **Markdown前提と tiptap(JSON) 前提が混在**（保存形式/レンダリング方針の単一正が未確定）  | 反映済み（tiptap JSON を正に統一し、read-only レンダリングで表示する方針へ）                                            | High   | 実装に直結（DBスキーマ/API/レンダリング/テストが変わる） | 01/02:「ノート=マークダウン」→「リッチテキスト（tiptap）」へ修正。03: 保存形式=tiptap JSON、表示=tiptap read-only（`editable: false`、`dangerouslySetInnerHTML` なし）、リンク許可プロトコル等を設計に反映。                                                                                |
| GAP-002 | - [済] | モード仕様                   | 02:「各モードはURLクエリで判定」「投稿のモードはURLパラメータで識別し、作成後は変更できない」/ 03:「画面状態（mode）はURLを単一正」「ModeSwitchでURL更新」「作成後は変更不可」 | **モードの決定点が二重**（URLのmodeを単一正とする設計と衝突しやすい）                   | 反映済み（エディタ内に別系統の mode 入力を設けず、モード切替は URL 更新のみ。保存時は URL の `mode` を採用）                           | High   | 仕様が曖昧だと編集/保存/一覧反映が破綻しやすい         | 02/03 の仕様を揃え、表示・保存・編集・一覧の mode が URL から一意に決まるように統一した。                                                                                                                                                                              |
| GAP-003 | - [済] | ログアウト                   | 03:「設計内容未定」/ 02:アイコン→ログアウト                                                                               | ログアウトの実装・遷移・エラー時のUXが未定                                     | 期待挙動を確定（例: `signOut` 成功→未ログイン画面へ即切替、失敗→sonnerで通知、ポップオーバーは閉じる、`router.refresh()`有無、URLは保持する等） | High   | 認証周りの完成条件が曖昧                     | 成功: Popover即閉→signOut→`router.replace("/")`→`router.refresh()`→未ログイン画面へフェードイン。失敗: `sonner` トースト＋URL変更なし。キャッシュ: `queryClient.removeQueries({ queryKey: ["posts"] })` と `queryClient.removeQueries({ queryKey: ["posts-filter"] })`。 |
| GAP-004 | - [済] | 認証/認可エラー時の導線            | 02:ログイン失敗はトースト/モーダル維持 / 03:エラー種別のみ                                                                       | **どの操作でログインモーダルを出すか**、401/403/404等の扱いが未定                   | 「未ログインで投稿操作→ログインモーダルを開く/トーストのみ/リダイレクト」などの方針を決め、エラー型→UIの対応表（sonner variant/文言/再試行導線）を追記       | High   | 実装はできてもUXがブレやすい                  | 03: UI対応表を追加（401=入力維持でログインモーダル自動表示、403/404=トースト＋状態維持、再試行導線）。02/06にも反映。                                                                                                                                                             |
| GAP-005 | - [済] | タグの識別子（URLとDB）          | 03:URLは `tags=<tagId>` / 02:タグはテキスト入力（label中心）                                                           | URL/DB/表示で **tagIdとlabelの関係が未定**（labelをURLに載せるのか、IDを載せるのか） | `tagId` の生成方式（`cuid`等）と、UIが扱う値（label）→URLに載せる値（tagId）への変換・保持戦略を明文化する                         | High   | ここが曖昧だと絞り込み/共有URL/正規化が実装できない     | 02: 「タグ（共通仕様）」を追加（URL=tagId、入力/表示=label）。03: 「タグの識別子（tagId / label）」を追加（tagId生成=`cuid()`、保存時 label→tagId 解決、未知tagIdは解除導線を提供）。                                                                                                      |
| GAP-006 | - [済] | タグの正規化・制約               | 02:新規タグ入力/サジェスト / 03:Tag.labelユニーク（ownerId+label）                                                        | label の **トリム/大小文字/全半角/最大長/禁止文字** が未定で重複や表示崩れが起きる          | 「保存時に正規化（trim/連続空白/大小文字など）」と制約（最大長・禁止文字）を定義し、同一性ルール（同名扱い）を明文化する                              | High   | DBユニーク制約違反の頻発を防ぐ                 | 02: 「タグ（共通仕様）」に `label` 正規化/制約を追記（前後trim/空白圧縮/全角半角正規化、空不可、最大32、大小文字区別）。03: 「タグlabelの正規化・制約（GAP-006）」を追加（サーバー側正規化、422/Alert、ユニーク制約違反の吸収）。                                                                                           |
| GAP-007 | - [済] | 複数タグ絞り込みの論理             | 03:`tags` は OR 条件 / 02:「複数タグを同時アクティブ」                                                                    | OR/AND の記載が docs 間で揃っていない（02は論理未記載）                        | 02 に「OR（いずれかを含む）」を明記（ANDにしたいなら 03 のURL設計と取得I/Fも含めて再検討）                                       | Medium | 共有URLの意味が変わるため早めに固定したい           | 02: 「タグ（共通仕様）」および「投稿一覧 > タグクラウド」に、複数タグは OR（いずれかを含む）を明記した。                                                                                                                                                                          |
| GAP-008 | - [済] | `view=trash` 時のフィルタ挙動   | 03:「ごみ箱ではタグ/お気に入り無効、URL値は保持」/ 02:記載なし                                                                    | ごみ箱画面での絞り込み可否が docs 間で不一致                                  | 02 にも「ごみ箱表示時はタグ/お気に入り絞り込みUIは非表示（URL値は保持）」を追記し、画面の状態定義を揃える                                    | Medium | 実装は可能だが、要件の誤解が起きやすい              | 02: 「タグ（共通仕様）」「投稿一覧（投稿検索）」「ごみ箱」に `view=trash` 中はタグ/お気に入り絞り込み UI を非表示（URL値は保持）を追記。                                                                                                                                                  |
| GAP-009 | - [済] | お気に入り絞り込みUIの形           | 02:「チェック」/ 03:FavoriteFilter（トグル想定）                                                                      | UI要素（checkbox/toggle/button）が未統一                           | 02/03 のどちらを正とするか決め、コンポーネント名・挙動（ONで `favorite=1` / OFFで削除）を統一する                               | Medium | 実装前に決めると手戻りが減る                   | 02: 投稿一覧「投稿検索」のお気に入りUIを「お気に入り絞り込みトグル（shadcn/ui Toggle）」に統一。ONで `favorite=1` 付与、OFFで `favorite` をURLから削除。 |
| GAP-010 | - [済] | 投稿一覧の表示仕様（本文）           | 01/02:本文の形式差（メモ/ノート） / 03:保存形式（tiptap）                                                                   | 一覧での本文表示（改行、長文の折りたたみ、メモは1行固定など）が未定                         | 一覧表示ルール（行数制限、全文展開の有無、noteのプレビュー生成）を追記する                                                      | Medium | 見た目・操作性・性能に影響                    | 02: メモは一覧で全文表示（省略なし）。ノートは最大10行まで表示し、10行超は「もっと見る/折りたたむ」で開閉（初期は折りたたみ）。03: 一覧本文は `contentText`（プレーンテキスト）を表示し、この表示ルールに従う。 |
| GAP-011 | - [済] | 編集中の状態遷移                | 02:「その場で編集」「キャンセル」 / 03:編集フローはあるが詳細未記載                                                                   | 編集中に「モード切替/フィルタ変更/戻る/リロード」した時の扱い（破棄・保持・警告）が未定              | 編集中の離脱ルール（自動キャンセル/confirm表示/URL変更禁止など）を決め、例外ケースを追記                                           | Medium | 想定外の入力破棄が起きやすい                   | 02/03: `hasEdits`（未保存の変更あり）を定義し、`hasEdits=true` の離脱は確認（破棄して続行 / 編集を続ける）を必須化。対象: モード切替・フィルタ変更・ごみ箱切替・他投稿編集開始・戻る/進む・リロード・タブを閉じる。 |
| GAP-012 | - [ ] | キャッシュ更新の具体（作成/更新/削除/復元） | 03:方針はあるが更新範囲の詳細が少ない                                                                                     | `mode/view` キャッシュを跨ぐ操作（ごみ箱投入/復元/完全削除）で、どのクエリキーをどう更新するかが未確定 | 「操作×現在表示×投稿属性」ごとのキャッシュ更新表を追記（`setQueryData` 対象キー、削除/挿入のルール）                                  | Medium | 実装の複雑度が高い箇所                      |                                                                                                                                                                                                                                    |
| GAP-013 | - [ ] | スクロール位置の復元方法            | 02:「スクロール位置は維持」/ 03:「TanStack Queryで復元」                                                                  | TanStack Query だけでは **スクロール位置は自動復元されない**ため実装方針が不足          | クエリキー単位のスクロール位置保存/復元（ScrollRestoration/自前管理）方針を追記する                                          | Medium | 体感UXに直結                          |                                                                                                                                                                                                                                    |
| GAP-014 | - [ ] | バリデーション定義（投稿/タグ）        | 02:「空ならAlert」/ 03:「上限文字数は要調査」                                                                            | 文字数上限・空白のみ・タグ数上限などの定義が不足                                   | 初期リリースの制約（投稿本文最大長、タグlabel最大長、1投稿あたりタグ数上限など）を決めて docs/06 の文言と併せて追記                            | Medium | テスト設計の前提になる                      |                                                                                                                                                                                                                                    |
| GAP-015 | - [ ] | ごみ箱「空にする」の削除対象と件数       | 02/03:「未ロード含め全件」                                                                                         | 「n件」の算出方法（未ロード含む総数の取得方法）が未定                                | UI上の件数表示を「ロード済み数」or「総数取得して表示」どちらにするか決め、必要なら総数取得API/集計を設計する                                   | Medium | 大量データ時の性能とUXに影響                  |                                                                                                                                                                                                                                    |
| GAP-016 | - [ ] | 永久削除のDB整合               | 02/03:「完全削除で復元不可」                                                                                        | PostTag の扱い（カスケード/明示削除）や Tag の残存（使われなくても残すか）が未定            | 「完全削除時の関連削除」「未使用タグを自動削除するか（初期は残す等）」を明文化する                                                    | Medium | DB整合/意図しないタグ消失を防ぐ                |                                                                                                                                                                                                                                    |
| GAP-017 | - [ ] | env一覧の不足                | 03:スタブに `USE_STUB_AUTH` を要求するが env表にない                                                                   | 参照される環境変数が docs 内で不整合                                      | 03 の「環境変数設計」表に `USE_STUB_AUTH`（および必要なら `USE_STUB_CRUD` 等）を追記し、既定値/本番禁止条件を明示する                | Low    | 立ち上げ時に詰まりやすい                     |                                                                                                                                                                                                                                    |
| GAP-018 | - [ ] | PWAアセットの確定              | 02/03:manifestキーはあるが色/アイコン未定                                                                             | `theme_color`/`background_color`/icons の実値が未確定             | 最低限の採用値（暫定でも可）と、アイコン作成物（192/512/maskable）の格納場所・命名を追記する                                       | Low    | 実装は後回し可能だが初期リリース要件に含まれる          |                                                                                                                                                                                                                                    |
| GAP-019 | - [ ] | カラースキーム                 | 03:「未定」                                                                                                  | UI実装のベース（CSS変数/テーマ）が未確定                                    | 初期は shadcn/ui デフォルトのテーマを採用するか、Miroのデザイン確定後に決定するかを明記する                                        | Low    | 見た目の統一に影響                        |                                                                                                                                                                                                                                    |
| GAP-020 | - [ ] | 非機能要件の数値化               | 01:高速/スムーズ / 03:パフォーマンス詳細未定                                                                              | 目標値（初期表示/追加取得/CLS等）が不足                                     | MVPの測定指標（例: 初回ロード、追加ロードの体感、CLS）と最低限の計測手段（Web Vitals/ログ）を追記する                                 | Low    | 「高速」の判定基準を作る                     |                                                                                                                                                                                                                                    |

# 反映先のガイド（提案）

- **最優先で整える**: `docs/01.要件定義書.md` と `docs/02.仕様書.md` に、`docs/03.設計書.md` の決定事項（投稿本文形式、モード仕様、タグ/フィルタ、ログアウト方針）を反映して矛盾を解消する
- 文言・トースト/アラート: `docs/06.テキスト・コンテンツ定義.md` に集約し、設計書からは参照する形に寄せる
