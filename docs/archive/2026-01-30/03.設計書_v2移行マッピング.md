---
title: 03.設計書 V2 移行マッピング
source:
author:
  -
published:
created: 2026-01-30
description:
tags:
---

# 目的

`docs/03.設計書.md`（V1）の内容を、責務（関心）ごとに分割した「設計書V2」へ移行するためのマッピング表。

- 見た目（レイアウト/ワイヤー）は Miro を単一正とする（本書は「実装の決定事項」を扱う）
- 本マッピングは「置き場所の案」であり、移行時に見出しの統合/改名は許容する

# V2（分割先）ファイル案

入口（索引）:
- `docs/03.設計書.v2.md`（索引/単一正マップ/各章へのリンク）

分割先（責務別）:
- `docs/03.v2/01_基盤-方針.md`（開発方針/システム構成/対象環境など）
- `docs/03.v2/02_設定-環境変数-PWA.md`（env/環境変数/manifest等）
- `docs/03.v2/03_UI基盤.md`（UI基盤ルール：shadcn/tailwind/breakpoints等）
- `docs/03.v2/10_URL-状態管理.md`（URLスキーム/canonical化/状態導出/URL更新規約）
- `docs/03.v2/20_認証-認可-スタブ.md`（Auth.js/認可単一正/スタブ運用ガード）
- `docs/03.v2/30_投稿-編集-本文形式.md`（エディタ/本文形式/contentText/保存・編集フロー）
- `docs/03.v2/40_タグ-お気に入り.md`（タグ識別子/正規化/絞り込み条件）
- `docs/03.v2/50_取得-キャッシュ-ページング.md`（TanStack Query/クエリキー/無限スクロール/scroll復元）
- `docs/03.v2/60_ごみ箱.md`（trash仕様/操作/一覧条件/選択状態）
- `docs/03.v2/70_エラー-通知.md`（エラー種別/UI対応表/開発用シミュレーション）
- `docs/03.v2/80_DBモデル.md`（User/Post/Tag/PostTag/インデックス）
- `docs/03.v2/90_品質-セキュリティ-テスト.md`（品質/性能/セキュリティ/テスト戦略）

設計書V2のスコープ外（運用手順へ移管推奨）:
- `docs/07.運用手順（CI・デプロイ）.md`（例: DBマイグレーション運用フロー）

# マッピング表（V1 → V2）

## 入口（索引）

| V1 見出し | V1 参照 | 移行先（V2） | 備考 |
| --- | --- | --- | --- |
| （全体の目次・探し方） | - | `docs/03.設計書.v2.md` | 「どこに何が書いてあるか」「単一正一覧」を集約する |

## 01_基盤-方針

| V1 見出し | V1 参照 | 移行先（V2） | 備考 |
| --- | --- | --- | --- |
| 開発・テストの方針 | `docs/03.設計書.md:11` | `docs/03.v2/01_基盤-方針.md` | TDD/スタブ方針など“前提”だけに絞る |
| 開発・テストの流れ | `docs/03.設計書.md:21` | `docs/03.v2/01_基盤-方針.md` | フェーズ説明（UI→認証/DB） |
| システム構成 | `docs/03.設計書.md:37` | `docs/03.v2/01_基盤-方針.md` | 採用技術一覧 |
| 可用性・運用 | `docs/03.設計書.md:68` | `docs/03.v2/01_基盤-方針.md` | 運用“手順”は別ドキュメントへ。ここは方針のみ |
| 対象ブラウザ | `docs/03.設計書.md:161` | `docs/03.v2/01_基盤-方針.md` | ブラウザ方針はここで単一正にする |

## 02_設定-環境変数-PWA

| V1 見出し | V1 参照 | 移行先（V2） | 備考 |
| --- | --- | --- | --- |
| 設定 | `docs/03.設計書.md:75` | `docs/03.v2/02_設定-環境変数-PWA.md` | 章タイトルはV2側で整理（env/secret/feature flag等） |
| envファイル構成 | `docs/03.設計書.md:76` | `docs/03.v2/02_設定-環境変数-PWA.md` | |
| 環境変数設計 | `docs/03.設計書.md:82` | `docs/03.v2/02_設定-環境変数-PWA.md` | |
| スマートフォンのホーム画面追加（PWA / manifest） | `docs/03.設計書.md:170` | `docs/03.v2/02_設定-環境変数-PWA.md` | manifest のキー・配置など“実装決定”を集約 |

## 03_UI基盤

| V1 見出し | V1 参照 | 移行先（V2） | 備考 |
| --- | --- | --- | --- |
| デザイン・レイアウト | `docs/03.設計書.md:97` | `docs/03.v2/03_UI基盤.md` | “レイアウトの単一正= Miro”の宣言と参照方法（MCP） |
| カラースキーム | `docs/03.設計書.md:107` | `docs/03.v2/03_UI基盤.md` | UIテーマの決定事項のみ |
| UI | `docs/03.設計書.md:118` | `docs/03.v2/03_UI基盤.md` | 共通UIの規約に限定する |
| コンポーネントテンプレート(shadcn/ui) | `docs/03.設計書.md:120` | `docs/03.v2/03_UI基盤.md` | ライブラリ方針/導入ルール |
| ブレイクポイント（Tailwindデフォルト） | `docs/03.設計書.md:133` | `docs/03.v2/03_UI基盤.md` | |

## 10_URL-状態管理

| V1 見出し | V1 参照 | 移行先（V2） | 備考 |
| --- | --- | --- | --- |
| 基本設計 | `docs/03.設計書.md:139` | `docs/03.v2/10_URL-状態管理.md` | “URL=SoT”など状態管理の原則のみここに残す |
| SPA（画面状態とURL） | `docs/03.設計書.md:141` | `docs/03.v2/10_URL-状態管理.md` | |
| ルーティング / URLスキーム設計 | `docs/03.設計書.md:193` | `docs/03.v2/10_URL-状態管理.md` | |
| 対象URL | `docs/03.設計書.md:197` | `docs/03.v2/10_URL-状態管理.md` | |
| URLスキーム（`/` の searchParams） | `docs/03.設計書.md:203` | `docs/03.v2/10_URL-状態管理.md` | |
| 表示別の URL 例（canonical） | `docs/03.設計書.md:216` | `docs/03.v2/10_URL-状態管理.md` | “effective filters”の説明も同章に集約 |
| 状態導出（URL → 画面） | `docs/03.設計書.md:230` | `docs/03.v2/10_URL-状態管理.md` | |
| URL更新規約（UI → URL） | `docs/03.設計書.md:235` | `docs/03.v2/10_URL-状態管理.md` | |
| URL正規化（canonical化）方針 | `docs/03.設計書.md:243` | `docs/03.v2/10_URL-状態管理.md` | |
| 正規化の目的 | `docs/03.設計書.md:250` | `docs/03.v2/10_URL-状態管理.md` | |
| 正規化ルール | `docs/03.設計書.md:254` | `docs/03.v2/10_URL-状態管理.md` | |
| 実装場所 | `docs/03.設計書.md:286` | `docs/03.v2/10_URL-状態管理.md` | “置き場所”はV2構成に合わせて更新 |
| 例 | `docs/03.設計書.md:294` | `docs/03.v2/10_URL-状態管理.md` | |
| 表示切り替え | `docs/03.設計書.md:553` | `docs/03.v2/10_URL-状態管理.md` | UI操作→URL更新の単一正。キャッシュ話は `50_取得-キャッシュ-ページング` にリンク |
| 表示切り替え 内部フロー | `docs/03.設計書.md:554` | `docs/03.v2/10_URL-状態管理.md` | フロー図はこの章に置き、queryKey詳細はリンクで逃がす |

## 20_認証-認可-スタブ

| V1 見出し | V1 参照 | 移行先（V2） | 備考 |
| --- | --- | --- | --- |
| ログイン | `docs/03.設計書.md:309` | `docs/03.v2/20_認証-認可-スタブ.md` | |
| 認証とセッション（実装設計） | `docs/03.設計書.md:310` | `docs/03.v2/20_認証-認可-スタブ.md` | |
| Google OAuth 設定一覧（MVP） | `docs/03.設計書.md:317` | `docs/03.v2/20_認証-認可-スタブ.md` | |
| セッションに載せる属性（アプリが参照してよい形） | `docs/03.設計書.md:329` | `docs/03.v2/20_認証-認可-スタブ.md` | |
| セッション失効・未認証時の挙動（MVP） | `docs/03.設計書.md:337` | `docs/03.v2/20_認証-認可-スタブ.md` | |
| 認可（authorId の単一正） | `docs/03.設計書.md:343` | `docs/03.v2/20_認証-認可-スタブ.md` | |
| 単一正（採用するユーザー識別子） | `docs/03.設計書.md:347` | `docs/03.v2/20_認証-認可-スタブ.md` | |
| 認可チェック位置（どこで検証するか） | `docs/03.設計書.md:354` | `docs/03.v2/20_認証-認可-スタブ.md` | |
| エラーの扱い（MVP） | `docs/03.設計書.md:363` | `docs/03.v2/20_認証-認可-スタブ.md` | |
| 認証フロー（ログイン: ユーザー操作／状態遷移） | `docs/03.設計書.md:408` | `docs/03.v2/20_認証-認可-スタブ.md` | |
| Auth.js（Google OAuth）内部フロー（セキュリティ観点） | `docs/03.設計書.md:432` | `docs/03.v2/20_認証-認可-スタブ.md` | |
| セッション確立後にセキュリティを保つ仕組み（認可の単一正） | `docs/03.設計書.md:478` | `docs/03.v2/20_認証-認可-スタブ.md` | |
| スタブ認証 | `docs/03.設計書.md:491` | `docs/03.v2/20_認証-認可-スタブ.md` | |
| スタブ認証の運用ガード | `docs/03.設計書.md:498` | `docs/03.v2/20_認証-認可-スタブ.md` | |
| ログアウト | `docs/03.設計書.md:520` | `docs/03.v2/20_認証-認可-スタブ.md` | |
| スタブ | `docs/03.設計書.md:1382` | `docs/03.v2/20_認証-認可-スタブ.md` | スタブ/本番切替は auth/投稿/DB を横断するため、章内で“接続ポイント”を明記 |
| スタブ／本番切り替え方針 | `docs/03.設計書.md:1383` | `docs/03.v2/20_認証-認可-スタブ.md` | |
| スタブ／モック設計 | `docs/03.設計書.md:1392` | `docs/03.v2/20_認証-認可-スタブ.md` | |
| 環境とスタブ／本番実装の使い分け | `docs/03.設計書.md:1403` | `docs/03.v2/20_認証-認可-スタブ.md` | |
| 投稿操作（Server Actions）の暫定ガード（Auth.js 未実装期間） | `docs/03.設計書.md:1416` | `docs/03.v2/20_認証-認可-スタブ.md` | “暫定”が消えるまでこの章に置く |

## 30_投稿-編集-本文形式

| V1 見出し | V1 参照 | 移行先（V2） | 備考 |
| --- | --- | --- | --- |
| 投稿エディタ | `docs/03.設計書.md:617` | `docs/03.v2/30_投稿-編集-本文形式.md` | |
| UI構成 | `docs/03.設計書.md:619` | `docs/03.v2/30_投稿-編集-本文形式.md` | |
| エディタ拡大（新規ノート） | `docs/03.設計書.md:640` | `docs/03.v2/30_投稿-編集-本文形式.md` | |
| エディタフレーム（共通デザイン） | `docs/03.設計書.md:660` | `docs/03.v2/30_投稿-編集-本文形式.md` | |
| 投稿本文の保存形式（tiptap JSON を正） | `docs/03.設計書.md:672` | `docs/03.v2/30_投稿-編集-本文形式.md` | |
| `contentText` の生成・保存 | `docs/03.設計書.md:683` | `docs/03.v2/30_投稿-編集-本文形式.md` | |
| 新規投稿 | `docs/03.設計書.md:699` | `docs/03.v2/30_投稿-編集-本文形式.md` | |
| バリデーション（正規化後） | `docs/03.設計書.md:715` | `docs/03.v2/30_投稿-編集-本文形式.md` | |
| 新規投稿保存フロー | `docs/03.設計書.md:731` | `docs/03.v2/30_投稿-編集-本文形式.md` | |
| 既存投稿の編集 | `docs/03.設計書.md:763` | `docs/03.v2/30_投稿-編集-本文形式.md` | |
| 編集中の離脱ガード（確認） | `docs/03.設計書.md:784` | `docs/03.v2/30_投稿-編集-本文形式.md` | |

## 40_タグ-お気に入り

| V1 見出し | V1 参照 | 移行先（V2） | 備考 |
| --- | --- | --- | --- |
| タグ / お気に入り | `docs/03.設計書.md:798` | `docs/03.v2/40_タグ-お気に入り.md` | |
| タグの識別子（tagId / label） | `docs/03.設計書.md:802` | `docs/03.v2/40_タグ-お気に入り.md` | |
| タグクラウド/候補の表示方針 | `docs/03.設計書.md:811` | `docs/03.v2/40_タグ-お気に入り.md` | |
| 画面状態（URL） | `docs/03.設計書.md:816` | `docs/03.v2/40_タグ-お気に入り.md` | URLの定義自体は `10_URL-状態管理` へ。ここは“タグ絞り込みの意味”に限定 |
| 投稿エディタでのタグ編集 | `docs/03.設計書.md:824` | `docs/03.v2/40_タグ-お気に入り.md` | |
| タグ ラベルの正規化・制約 | `docs/03.設計書.md:835` | `docs/03.v2/40_タグ-お気に入り.md` | |
| 適用ポイント | `docs/03.設計書.md:837` | `docs/03.v2/40_タグ-お気に入り.md` | |
| 正規化ルール（`normalizeTagLabel`） | `docs/03.設計書.md:844` | `docs/03.v2/40_タグ-お気に入り.md` | |
| バリデーション（正規化後） | `docs/03.設計書.md:853` | `docs/03.v2/40_タグ-お気に入り.md` | |
| 同一性・競合時の扱い | `docs/03.設計書.md:860` | `docs/03.v2/40_タグ-お気に入り.md` | |
| 投稿一覧：絞り込み | `docs/03.設計書.md:869` | `docs/03.v2/40_タグ-お気に入り.md` | “取得方法”は `50_取得-キャッシュ-ページング` へリンク |

## 50_取得-キャッシュ-ページング

| V1 見出し | V1 参照 | 移行先（V2） | 備考 |
| --- | --- | --- | --- |
| SPA（投稿一覧キャッシュの切替） | `docs/03.設計書.md:153` | `docs/03.v2/50_取得-キャッシュ-ページング.md` | URL側の原則は `10_URL-状態管理` に置き、ここはキャッシュの単一正 |
| データ取得/キャッシュ | `docs/03.設計書.md:880` | `docs/03.v2/50_取得-キャッシュ-ページング.md` | |
| 投稿一覧 | `docs/03.設計書.md:890` | `docs/03.v2/50_取得-キャッシュ-ページング.md` | ここは“取得と表示の責務境界”を中心に |
| 入力（Source） | `docs/03.設計書.md:892` | `docs/03.v2/50_取得-キャッシュ-ページング.md` | |
| 投稿検索（タグ/お気に入り） | `docs/03.設計書.md:899` | `docs/03.v2/50_取得-キャッシュ-ページング.md` | |
| 表示ルール | `docs/03.設計書.md:905` | `docs/03.v2/50_取得-キャッシュ-ページング.md` | UI仕様そのものは `docs/02`。ここは“実装上のルール” |
| 投稿データ取得・キャッシュ戦略（TanStack Query） | `docs/03.設計書.md:916` | `docs/03.v2/50_取得-キャッシュ-ページング.md` | |
| クエリキー設計 | `docs/03.設計書.md:923` | `docs/03.v2/50_取得-キャッシュ-ページング.md` | |
| キャッシュ方針 | `docs/03.設計書.md:933` | `docs/03.v2/50_取得-キャッシュ-ページング.md` | |
| スクロール位置の保存/復元（Scroll Restoration） | `docs/03.設計書.md:942` | `docs/03.v2/50_取得-キャッシュ-ページング.md` | |
| キャッシュ更新 | `docs/03.設計書.md:1014` | `docs/03.v2/50_取得-キャッシュ-ページング.md` | |
| 投稿の自動取得（無限スクロール） | `docs/03.設計書.md:1049` | `docs/03.v2/50_取得-キャッシュ-ページング.md` | |
| 投稿一覧ページング（カーソル方式）内部設計 | `docs/03.設計書.md:1055` | `docs/03.v2/50_取得-キャッシュ-ページング.md` | |
| UI責務と更新 | `docs/03.設計書.md:1089` | `docs/03.v2/50_取得-キャッシュ-ページング.md` | |

## 60_ごみ箱

| V1 見出し | V1 参照 | 移行先（V2） | 備考 |
| --- | --- | --- | --- |
| ごみ箱 | `docs/03.設計書.md:1098` | `docs/03.v2/60_ごみ箱.md` | |
| ごみ箱の基本設計 | `docs/03.設計書.md:1100` | `docs/03.v2/60_ごみ箱.md` | |
| ごみ箱内の各投稿の要素 | `docs/03.設計書.md:1107` | `docs/03.v2/60_ごみ箱.md` | |
| ごみ箱一覧上部のインターフェース | `docs/03.設計書.md:1122` | `docs/03.v2/60_ごみ箱.md` | |

## 70_エラー-通知

| V1 見出し | V1 参照 | 移行先（V2） | 備考 |
| --- | --- | --- | --- |
| エラーハンドリング: エラー通知実装設計 | `docs/03.設計書.md:1148` | `docs/03.v2/70_エラー-通知.md` | |
| エラー種別 | `docs/03.設計書.md:1150` | `docs/03.v2/70_エラー-通知.md` | |
| UI対応表 | `docs/03.設計書.md:1164` | `docs/03.v2/70_エラー-通知.md` | |
| 開発環境用エラーシミュレーション | `docs/03.設計書.md:1185` | `docs/03.v2/70_エラー-通知.md` | |

## 80_DBモデル

| V1 見出し | V1 参照 | 移行先（V2） | 備考 |
| --- | --- | --- | --- |
| データモデル設計（DB） | `docs/03.設計書.md:1204` | `docs/03.v2/80_DBモデル.md` | |
| User テーブル | `docs/03.設計書.md:1206` | `docs/03.v2/80_DBモデル.md` | |
| Post テーブル | `docs/03.設計書.md:1215` | `docs/03.v2/80_DBモデル.md` | |
| インデックス設計（投稿一覧のみ） | `docs/03.設計書.md:1231` | `docs/03.v2/80_DBモデル.md` | |
| Tag テーブル | `docs/03.設計書.md:1252` | `docs/03.v2/80_DBモデル.md` | |
| PostTag テーブル（中間） | `docs/03.設計書.md:1259` | `docs/03.v2/80_DBモデル.md` | |

## 90_品質-セキュリティ-テスト

| V1 見出し | V1 参照 | 移行先（V2） | 備考 |
| --- | --- | --- | --- |
| 品質 | `docs/03.設計書.md:1271` | `docs/03.v2/90_品質-セキュリティ-テスト.md` | |
| 非同期処理の多重実行防止設計 | `docs/03.設計書.md:1273` | `docs/03.v2/90_品質-セキュリティ-テスト.md` | |
| 非機能要件 / パフォーマンス・チューニング | `docs/03.設計書.md:1286` | `docs/03.v2/90_品質-セキュリティ-テスト.md` | |
| セキュリティ | `docs/03.設計書.md:1300` | `docs/03.v2/90_品質-セキュリティ-テスト.md` | |
| セキュリティ対策 | `docs/03.設計書.md:1301` | `docs/03.v2/90_品質-セキュリティ-テスト.md` | |
| テスト | `docs/03.設計書.md:1314` | `docs/03.v2/90_品質-セキュリティ-テスト.md` | |
| テスト戦略（Jest, モック, スタブ） | `docs/03.設計書.md:1315` | `docs/03.v2/90_品質-セキュリティ-テスト.md` | |
| テストレベル別のDB/スタブ方針 | `docs/03.設計書.md:1325` | `docs/03.v2/90_品質-セキュリティ-テスト.md` | |
| 単体テスト（例・ToDo 含む） | `docs/03.設計書.md:1346` | `docs/03.v2/90_品質-セキュリティ-テスト.md` | |
| 結合テスト（例・ToDo 含む） | `docs/03.設計書.md:1365` | `docs/03.v2/90_品質-セキュリティ-テスト.md` | |
| E2Eテスト | `docs/03.設計書.md:1372` | `docs/03.v2/90_品質-セキュリティ-テスト.md` | |

## 運用手順へ移管（設計書V2には置かない）

| V1 見出し | V1 参照 | 移行先（運用） | 備考 |
| --- | --- | --- | --- |
| DBマイグレーション運用フロー（開発→本番） | `docs/03.設計書.md:1429` | `docs/07.運用手順（CI・デプロイ）.md` | 設計（構造/方針）と運用（手順）を分離する |

