---
title: 05. 作業計画進行チェックリスト
created: 2025-12-05
description: フェーズ別に進捗を管理するためのチェックリスト
---

# 作業計画進行チェックリスト

## 運用前提
- 参照必須: `docs/02. 要件定義書.md`、`docs/03. 設計書.md`、`docs/04. 作業計画書.md`、`docs/06. 表示テキスト定義.md`、`AGENTS.md`。
- 開発方針: TDD（Red→Green→Refactor）を前提に、未実装の依存はスタブ／モックで先行し、接続ポイント（例: `authAdapter` / `postRepository`）で環境変数切替する。本番ではスタブ無効ガードを入れる。
- テスト: UI／ロジックは Jest+RTL、認証／DBは Route Handler + Server Action + Prisma で結合テスト。`NODE_ENV=test` ではスタブを無効化する。
- UI(shadcn/ui): 原則として **shadcn CLI でコンポーネントを追加して利用する**（手動実装を避ける）。追加要件は公式実装を直接改変しすぎず、ラッパーで拡張する。

## ステータス記号と更新手順
- 記号: `☐` 未着手 / `△` 進行中 / `☑` 完了 / `✕` 中止
- 更新手順:
  - 着手前に対象行を `△` にし、必要に応じて期日・担当を追記。
  - 作業完了で `☑` にし、完了条件を満たした根拠（テスト名や確認方法）をコメントとして残す。
  - 仕様変更で無効になった場合は `✕` とし、理由をコメントに残す。

## 共通テンプレ
- カラム: 状態 / ID / 概要 / 完了条件 / 前提ID / 担当 / 期日(YYYY-MM-DD または `-`)
- ID命名: `P{フェーズ}-{領域}-{通番2桁}` 例) `P1-UI-01`
- 完了条件にはテスト/確認方法を含める。
- 前提ID: 依存するタスクのID（複数ある場合はカンマ区切り、なしの場合は `-`）
- 記入例:

| 状態 | ID | 概要 | 完了条件 | 前提ID | 担当 | 期日 |
| --- | --- | --- | --- | --- | --- | --- |
| ☐ | Pn-XX-01 | サンプル | Red→Green→Refactorを完了し、関連テストがGREEN | - | - | 2025-12-31 |

## フェーズ別チェックリスト

### フェーズ0
| 状態 | ID | 概要 | 完了条件 | 前提ID | 担当 | 期日 |
| --- | --- | --- | --- | --- | --- | --- |
| ☑ | P0-SET-01 | `AGENTS.md` 設定と遵守導線の確認 | READMEに「開発者向けガイド」を追加しAGENTSの禁止事項/方針を参照導線化 | - | - | - |
| ☑ | P0-SET-02 | 必読ドキュメントの配置確認 | `docs/01-06` の配置確認済み＋READMEから主要ドキュメントへの導線を追加 | - | - | - |

### フェーズ1

**完了時の到達点**: スタブモードでUIの一通りの操作が確認できる状態（Vercelデモ用デプロイ可能）

**推奨の実行順序（画面A→B→C→D。ただし依存優先）**:

- フェーズ1は **画面（ビュー）単位**で進める。推奨順は **画面A（未ログイン）→ 画面B（ログイン中タイムライン）→ 画面C（ゴミ箱）→ 画面D（横断UI）**。
- 各画面は、(1) UI/レイアウト、(2) スタブ/モックによる代替実装（`authAdapter` / `postRepository` 経由）、(3) テスト（Red→Green→Refactor）までを1セットとして完了させる。
- ただし、実行順は固定ではなく、**前提ID（依存関係）を満たすことを最優先**とする（前提IDが完了していない行は着手しない）。
- 本チェックリスト内の「サブフェーズ1-A〜1-G」は、タスクの分類（見通し・抜け漏れ防止）であり、画面実装の都合で **複数サブフェーズを横断して進めてよい**（例: 画面Aで必要な Dialog/sonner を 1-B から先行実装する等）。

**フェーズ1のDone定義（原則: 解釈1）**:

- 原則として、各タスクは **対象コンポーネント/対象ビュー内で完結**してGREENになれば完了（例: ボタンの表示・モーダル開閉・一覧の描画など）。
- 例外として、ユーザー体験として不可欠な **導線・状態保持・ビュー切替・キャッシュ整合**は「連携タスク」として完了条件に含める（解釈2）。
  - 例（フェーズ1の連携タスク）: `P1-LAY-04`, `P1-AUTH-03`, `P1-AUTH-05`, `P1-FLT-02`, `P1-TRASH-01`, `P1-TRASH-04`, `P1-LIST-04`

**サブフェーズと画面（ビュー）の対応（目安）**:

- 1-A（環境構築・基盤）: **全画面の前提**
- 1-B（共通UIパーツ）: **横断（画面A〜D）**（必要な分を先行実装してよい）
- 1-C（レイアウト・認証UI）: **主に画面A/B**
- 1-D（投稿エディタ）: **主に画面B**
- 1-E（投稿一覧）: **主に画面B**
- 1-F（表示切替・ゴミ箱）: **主に画面B/C**
- 1-G（エラーハンドリング）: **主に画面D（横断UI・品質）**

**スタブ環境変数**:
- `NEXT_PUBLIC_USE_STUB_AUTH=true` — 認証スタブ有効
- `NEXT_PUBLIC_USE_STUB_POSTS=true` — 投稿CRUDスタブ有効
- 本番（`NODE_ENV=production`）では上記が設定されていてもスタブ無効

#### サブフェーズ1-A: 環境構築・基盤（全画面の前提）

| 状態 | ID | 概要 | 完了条件 | 前提ID | 担当 | 期日 |
| --- | --- | --- | --- | --- | --- | --- |
| ☑ | P1-ENV-01 | Next.js 15 プロジェクト初期化 | `next dev` が起動し、サンプルページが表示される。テストファイル作成可能 | - | - | - |
| ☑ | P1-ENV-02 | Biome設定 | `pnpm lint` / `pnpm format` が動作し、設定ファイルがコミット済み | P1-ENV-01 | - | - |
| ☑ | P1-ENV-03 | Jest + React Testing Library セットアップ | サンプルテストが `pnpm test` でGREEN。`jest.config.*` とテストスクリプトが整備済み | P1-ENV-01 | - | - |
| ☑ | P1-ENV-04 | TailwindCSS + shadcn/ui 初期化 | shadcn CLI でコンポーネント追加可能。`components.json` が設定済み | P1-ENV-01 | - | - |
| ☑ | P1-ENV-05 | 外観（テーマ）基盤: ThemeProvider 導入（next-themes） | `ThemeProvider attribute="class" defaultTheme="system" enableSystem` を RootLayout 配下に導入し、hydration warning 対策（必要なら `suppressHydrationWarning`）を実施。`sonner` の `Toaster` が ThemeProvider 配下でレンダリングされる。テストでGREEN | P1-ENV-04,P1-UI-05 | - | - |
| ☑ | P1-ADP-01 | 環境変数によるスタブ切替機構 | `NEXT_PUBLIC_USE_STUB_AUTH` / `NEXT_PUBLIC_USE_STUB_POSTS` で切替可能。`NODE_ENV=production` でスタブ無効ガード実装済み | P1-ENV-01 | - | - |
| ☑ | P1-ADP-02 | authAdapter スタブ実装 | スタブログイン/ログアウト/セッション取得が動作。環境変数で切替可能。テストでGREEN | P1-ADP-01 | - | - |
| ☑ | P1-ADP-03 | postRepository スタブ実装 | スタブCRUD（create/findMany/findById/update/softDelete/restore/hardDelete）が動作。環境変数で切替可能。テスト22件すべてGREEN | P1-ADP-01 | - | 2025-12-15 |

#### サブフェーズ1-B: 共通UIパーツ（横断: 画面A〜D）

| 状態 | ID | 概要 | 完了条件 | 前提ID | 担当 | 期日 |
| --- | --- | --- | --- | --- | --- | --- |
| ☑ | P1-UI-01 | Button（shadcn） | **`pnpm dlx shadcn@latest add button` を実行**し、`@/components/ui/button` を利用できる。表示確認 or テストでGREEN | P1-ENV-04 | - | - |
| ☑ | P1-UI-02 | Spinner（shadcn + フェード演出） | **`pnpm dlx shadcn@latest add spinner` を実行**し、公式 `Spinner` を利用する。フェード/レイアウトシフト防止はラッパーで実装。テストでマウント/アンマウント確認。実装: `SpinnerWithFade` コンポーネント作成、テスト: `__tests__/components/ui/spinner-with-fade.test.tsx` (3件GREEN) | P1-UI-01 | - | 2025-12-16 |
| ☑ | P1-UI-03 | Dialog（shadcn） | **`pnpm dlx shadcn@latest add dialog` を実行**し、開閉動作（×/背景クリックで閉じる）がGREEN | P1-UI-01 | - | - |
| ☑ | P1-UI-04 | Alert / Alert-Dialog（shadcn） | **`pnpm dlx shadcn@latest add alert` / `pnpm dlx shadcn@latest add alert-dialog` を実行**し、確認ダイアログの表示・ボタン押下で閉じる。テストでGREEN。実装: `components/ui/alert.tsx`, `components/ui/alert-dialog.tsx`、テスト: `__tests__/components/ui/alert-dialog.test.tsx` (3件GREEN) | P1-UI-01 | - | 2025-12-16 |
| ☑ | P1-UI-05 | sonner | **`pnpm dlx shadcn@latest add sonner` を実行**し、`app/layout.tsx` に `<Toaster position="bottom-center" />` を配置してsonnerで成功/エラー/情報通知を表示できる。**すべてのトーストはクリックで即座に閉じられる。** テストでGREEN。実装: `components/ui/sonner.tsx` を使用し、`components/dev/UiPlayground.tsx` から `toast.*` を呼び出し、テスト: `__tests__/components/dev/UiPlayground-updated.test.tsx` / `__tests__/app/root-layout.test.tsx` で動作確認 | P1-UI-01 | - | 2025-12-16 |
| ☑ | P1-UI-06 | Checkbox（shadcn） | **`pnpm dlx shadcn@latest add checkbox` を実行**し、チェック切替（controlled/uncontrolled対応）。テストでGREEN。実装: `components/ui/checkbox.tsx`、テスト: `__tests__/components/ui/checkbox.test.tsx` (2件GREEN) | P1-UI-01 | - | 2025-12-16 |
| ☑ | P1-UI-07 | Popover（shadcn） | **`pnpm dlx shadcn@latest add popover` を実行**し、開閉動作（外側クリックで閉じる）。テストでGREEN。実装: `components/ui/popover.tsx`、テスト: `__tests__/components/ui/popover.test.tsx` (2件GREEN) | P1-UI-01 | - | 2025-12-16 |

#### サブフェーズ1-C: レイアウト・認証UI（主に画面A/B）

| 状態 | ID | 概要 | 完了条件 | 前提ID | 担当 | 期日 |
| --- | --- | --- | --- | --- | --- | --- |
| ☑ | P1-LAY-01 | 共通レイアウト（Header/Main/Footer枠） | 基本レイアウト構造がレスポンシブで表示。md以上で左右分割対応 | P1-UI-01 | - | - |
| ☑ | P1-LAY-02 | Header（未ログイン状態） | アプリ名＋ログインボタンのみ表示。テストでGREEN | P1-LAY-01 | - | - |
| ☑ | P1-LAY-03 | Header（ログイン状態）枠 | md以上: 表示切替（中央配置）＋ユーザーアイコン（右寄せ）の枠を表示。md未満: ユーザーアイコン（右寄せ）のみ表示。テストでGREEN。実装: `components/layout/AuthenticatedHeader.tsx`、テスト: `__tests__/components/layout/authenticated-header.test.tsx` (3件GREEN) | P1-LAY-01 | - | - |
| ☑ | P1-LAY-04 | セッション判定（Server Component） | スタブセッションで未ログイン/ログイン中の画面分岐。テストでGREEN。実装: `app/page.tsx`（Server Component）、`lib/session.ts`、テスト: `__tests__/lib/session.test.ts` (4件GREEN)、`__tests__/app/page.test.tsx` (2件GREEN) | P1-ADP-02,P1-LAY-01 | - | - |
| ☑ | P1-AUTH-01 | ログインボタン | 押下でモーダル表示（状態管理のみ）。テストでGREEN | P1-LAY-02,P1-UI-03 | - | - |
| ☑ | P1-AUTH-02 | ログインモーダル（枠のみ） | Dialog内に「Googleでログイン」ボタン表示。×/背景で閉じる。テストでGREEN | P1-AUTH-01 | - | - |
| ☑ | P1-AUTH-03 | ログインモーダル → スタブ認証連携 | ボタン押下でauthAdapter経由のスタブログイン実行。セッション更新後画面切替。テストでGREEN | P1-AUTH-02,P1-ADP-02 | - | - |
| ☑ | P1-AUTH-04 | ユーザーアイコン + Popover（枠のみ） | アイコン押下でポップオーバー開閉。ユーザー名表示。**外側クリックで閉じる**。テストでGREEN。実装: `components/auth/UserPopover.tsx`、`components/auth/UserAvatarButton.tsx`、テスト: `__tests__/components/auth/user-popover.test.tsx` (4件GREEN: 開閉・外側クリック・Esc・ログアウト) | P1-LAY-03,P1-UI-07 | - | - |
| ☑ | P1-AUTH-05 | ログアウトリンク | ポップオーバー内リンク押下でスタブログアウト。セッション更新後画面切替。テストでGREEN。実装: `components/auth/UserPopover.tsx`（ログアウトボタン）、テスト: `__tests__/components/auth/user-popover.test.tsx` (ログアウト動作確認含む) | P1-AUTH-04,P1-ADP-02 | - | - |
| ☑ | P1-RSK-01 | 認証スタブ運用ガード | docs/03, docs/04, docs/05 にスタブCookieの開発専用利用・環境変数ガードを明記し、CI/本番でスタブが動かないことを確認。テスト/レビュー記録を残す。実装: `lib/auth/constants.ts`（USE_STUB_AUTH定義）、`lib/authAdapter/server.ts`/`client.ts`（ガード追加）、`app/api/auth/stub/route.ts`（Route Handlerガード追加）、`docs/03. 設計書.md`（運用ガード詳細追記）、`docs/04. 作業計画書.md`（リスク管理説明追記）、`docs/05. 作業計画進行チェックリスト.md`（完了条件記載） | P1-AUTH-03 | - | - |
| ☑ | P1-LAY-05 | Footer（未ログインのみ） | 未ログイン時のみコピーライトを表示（ログイン中は非表示）。テストでGREEN | P1-UI-01 | - | - |
| ✕ | P1-LAY-06 | Footer（ログイン中・md未満） | ✕（設計変更: ログイン中はフッター非表示、表示切替は画面下部に固定） | P1-LAY-05,P1-FLT-01 | - | - |
| ☑ | P1-LAY-07 | 表示切替UI配置（レスポンシブ） | md以上: ヘッダー内に表示切替（「ごみ箱を見る」リンク含む）を表示。md未満: 画面下部に固定表示。テストでGREEN。実装: `components/layout/ViewSwitcher.tsx`、`components/layout/AuthenticatedHeader.tsx`、`components/landing/AuthenticatedLanding.tsx`（mainにpb-20 md:pb-0追加）、テスト: `__tests__/components/layout/authenticated-header.test.tsx` (2件GREEN: ViewSwitcherが1つ存在・クラス確認)、`__tests__/components/landing/authenticated-landing.test.tsx` (2件GREEN: pb-*確認・ViewSwitcher存在確認) | P1-LAY-03 | - | - |
| ☑ | P1-WELC-01 | ウェルカムメッセージ表示 | 未ログイン時にメッセージ＋ログインボタン表示。表示テキスト定義を参照。テストでGREEN | P1-LAY-02 | - | - |
| ☑ | P1-WELC-02 | Link（未ログイン画面） | 未ログインのメイン内に外部リンク（GitHub/X/お問い合わせ）を表示。テストでGREEN | P1-WELC-01 | - | - |
| ☑ | P1-WELC-03 | ウェルカムセクションの整列調整 | `main`中央揃え＋見出し左揃えをTailwindで実装し、`pnpm run dev`プレビューで反映確認 | P1-WELC-01 | - | 2025-12-14 |
<!-- 2025-12-14: WelcomeSection の main に textAlign=center を適用し、`pnpm run dev` + ブラウザ確認で反映を確認 -->

#### サブフェーズ1-D: 投稿エディタ（主に画面B）

| 状態 | ID | 概要 | 完了条件 | 前提ID | 担当 | 期日 |
| --- | --- | --- | --- | --- | --- | --- |
| ☑ | P1-EDIT-01 | エディタ枠（tiptap設置） | **tiptapパッケージ導入済み**。tiptapエディタが表示され、テキスト入力可能。テストでGREEN（__tests__/components/timeline/PostEditor.test.tsx「tiptapエディタが表示される」） | P1-ENV-04 | - | - |
| ☑ | P1-EDIT-02 | モードチェックボックス（メモ/ToDo） | 初期値メモ。切替動作。テストでGREEN（同テスト「モード切替の初期値はメモで、切替動作が正しい」） | P1-EDIT-01,P1-UI-06 | - | - |
| ☑ | P1-EDIT-03 | 保存ボタン（未入力時Alert） | 未入力で保存押下時にAlertを表示。テストでGREEN（同テスト「未入力で保存押下時にAlertを表示」） | P1-EDIT-01,P1-UI-04 | - | - |
| ☑ | P1-EDIT-04 | 保存ボタン → スタブCRUD連携 | postRepository.create呼出。sonnerで成功通知表示。テストでGREEN（同テスト「正常保存でpostRepository.create/toast.success/エディタクリア・フォーカス呼び出し」） | P1-EDIT-03,P1-ADP-03,P1-UI-05 | - | - |
| ☑ | P1-EDIT-05 | 保存後のクリア＋フォーカス | 保存成功後にエディタクリア。フォーカス戻し。テストでGREEN（同テスト「正常保存でpostRepository.create/toast.success/エディタクリア・フォーカス呼び出し」） | P1-EDIT-04 | - | - |
| ☑ | P1-EDIT-06 | 編集モード切替（既存投稿ロード） | 編集ボタン押下で該当投稿をエディタにセット。モードも反映。テストでGREEN。実装: `components/timeline/PostEditor.tsx`（editingPost propでエディタにロード、useEffectでモード反映）、`components/landing/AuthenticatedLanding.tsx`（編集状態管理）、テスト: `__tests__/components/timeline/PostEditor.test.tsx` (編集モードロードテスト含む)、`__tests__/components/landing/authenticated-landing.test.tsx` (編集→キャンセル→モード維持テスト含む) | P1-EDIT-02,P1-ADP-03 | - | - |
| ☑ | P1-EDIT-07 | 更新ボタン＋キャンセルボタン | 編集時は「更新」ラベル。キャンセルで元に戻る。更新処理はpostRepository.update経由。テストでGREEN。実装: `components/timeline/PostEditor.tsx`（handleCancelでclearContent/focus追加、invalidateQueriesでauthorId一致のpostsクエリを無効化）、テスト: `__tests__/components/timeline/PostEditor.test.tsx` (キャンセル時のクリア/フォーカステスト、invalidateQueriesテスト含む) | P1-EDIT-06 | - | - |

#### サブフェーズ1-E: 投稿一覧（主に画面B）

| 状態 | ID | 概要 | 完了条件 | 前提ID | 担当 | 期日 |
| --- | --- | --- | --- | --- | --- | --- |
| ☑ | P1-LIST-01 | 一覧コンテナ（Skeletonローディング表示） | ローディング中はSkeleton表示。ローディング中は実データを非表示にし、完了後Skeletonを非表示にして実データを表示。レイアウトシフト防止。テストでGREEN（__tests__/components/timeline/PostList.test.tsx「ローディング中はSkeleton表示・投稿非表示」） | P1-UI-02 | - | - |
| ☑ | P1-LIST-02 | スタブデータ10件の初期ロード | **TanStack Query導入・QueryClientProvider設定済み**。postRepository.findMany → 更新日降順で10件表示。キャッシュ保持。テストでGREEN（同テスト「取得成功時に10件を描画」） | P1-LIST-01,P1-ADP-03 | - | - |
| ☑ | P1-LIST-03 | 個別投稿アイテム（表示のみ） | モード/投稿日/更新日（**dayjs導入・日時フォーマット実装済み**）/本文を表示。テストでGREEN。実装: `components/timeline/PostItem.tsx`、テスト: `__tests__/components/timeline/PostItem.test.tsx` (7件GREEN: 内容表示・モードバッジ・日時フォーマット・編集ボタン・ゴミ箱ボタン・view=trash時の非表示) | P1-LIST-02 | - | - |
| ☑ | P1-LIST-04 | 個別投稿アイテム（編集ボタン） | ボタン押下でonEditコールバックが呼ばれる。テストでGREEN。実装: `components/timeline/PostItem.tsx`（編集ボタンとonEdit prop）、テスト: `__tests__/components/timeline/PostItem.test.tsx` (編集ボタンクリックテスト含む)。注: エディタへの切替連携はP1-EDIT-06で実装予定 | P1-LIST-03 | - | - |
| ☑ | P1-LIST-05 | 個別投稿アイテム（ゴミ箱ボタン） | ボタン押下でpostRepository.softDelete。一覧から消える。テストでGREEN。実装: `components/timeline/PostItem.tsx`（ゴミ箱ボタンとonDelete prop）、`components/timeline/PostList.tsx`（deleteMutation実装）、テスト: `__tests__/components/timeline/PostItem.test.tsx` (ゴミ箱ボタンクリックテスト含む)、`__tests__/components/timeline/PostList.test.tsx` (softDelete呼び出し・キャッシュ無効化テスト含む) | P1-LIST-03,P1-ADP-03 | - | - |
| ☑ | P1-LIST-06 | ソートUIボタン群（G1/G2） | 更新順/投稿順 × 昇順/降順のボタン表示（手動順はフェーズ2）。テストでGREEN。実装: `components/timeline/PostSortControls.tsx`、テスト: `__tests__/components/timeline/PostList.test.tsx` (ソートUIボタン群表示テスト含む) | P1-LIST-02 | - | - |
| ☑ | P1-LIST-07 | ソートロジック（G1/G2連動） | ボタン押下で一覧のソート順が変わる（更新順/投稿順 × 昇降）。テストでGREEN。実装: `PostList`に`sortBy/sortOrder` props追加、`createPostsQueryKey`に`sortBy/sortOrder`追加、`normalizeHomeSearchParams`に`sortBy/sortOrder`正規化追加、テスト: `__tests__/lib/routing/normalizeHomeSearchParams.test.ts` (sortBy/sortOrder正規化テスト含む)、`__tests__/components/timeline/PostList.test.tsx` (ソートリンククリックテスト含む) | P1-LIST-06 | - | - |
| ✕ | P1-LIST-08 | 手動並び替え（上下ボタン） | ✕（設計変更: 投稿の手動並び替えはフェーズ2で実装する） | P1-LIST-02 | - | - |
| ✕ | P1-LIST-09 | 手動並び替え（D&D、md以上） | ✕（設計変更: 投稿の手動並び替えはフェーズ2で実装する） | P1-LIST-08 | - | - |
| ☑ | P1-LIST-10 | 無限スクロールUI（スタブ） | IntersectionObserver で100px手前を検知し、postRepositoryスタブから追加ロード。Skeleton表示・全件取得メッセージ・レイアウトシフト防止を含むテストがGREEN。実装: `components/timeline/PostList.tsx`（IntersectionObserver、追加フェッチ時のSkeleton、全件取得メッセージ「すべての投稿を取得しました」、loadMoreRefによるトリガー要素）。注: テストはPostList.test.tsxに含まれる想定だが、無限スクロールの明示的なテストは今後追加可能 | P1-LIST-02 | - | - |

#### サブフェーズ1-F: 表示切替・ゴミ箱（主に画面B/C）

| 状態 | ID | 概要 | 完了条件 | 前提ID | 担当 | 期日 |
| --- | --- | --- | --- | --- | --- | --- |
| ☑ | P1-FLT-01 | 表示切替ボタン群（すべて/メモ/ToDo） | 各ボタンで一覧フィルタが切り替わる。テストでGREEN。実装: `components/layout/ViewSwitcher.tsx`（既存）、テスト: `__tests__/components/layout/ViewSwitcher.test.tsx` (11件GREEN: ボタン表示・variant切替・リンク生成・クエリ保持)、`__tests__/components/landing/authenticated-landing.test.tsx` (3件GREEN: searchParams.mode連携) | P1-LIST-02 | - | - |
| ☑ | P1-FLT-02 | クエリパラメータ連動（mode=） | URLパラメータで状態保持。`mode=all` を含めて明示し、戻る/進むで復元。テストでGREEN。実装: `lib/routing/normalizeHomeSearchParams.ts`（正規化関数）、`app/page.tsx`（redirect連携）、`docs/03. 設計書.md`（URL正規化方針追記）、テスト: `__tests__/lib/routing/normalizeHomeSearchParams.test.ts` (16件GREEN: mode未指定/不正値/正規値・view正規化・未知クエリ保持) | P1-FLT-01 | - | - |
| ☑ | P1-TRASH-01 | ゴミ箱ビュー枠（view=trash） | クエリパラメータでゴミ箱表示に切替。通常一覧のキャッシュ保持。テストでGREEN。実装: `components/landing/AuthenticatedLanding.tsx`（既存）、`components/timeline/PostList.tsx`（既存）、テスト: `__tests__/components/landing/authenticated-landing.test.tsx` (2件GREEN: view=trash連携)、`__tests__/components/timeline/PostList.test.tsx` (既存テストでカバー: view=trash表示・mode無視・キャッシュ保持) | P1-FLT-02 | - | - |
| ☑ | P1-TRASH-02 | ゴミ箱一覧（trashedのみ表示） | status=trashedの投稿をスタブから取得・表示。テストでGREEN。実装: `components/timeline/PostList.tsx`（既存）、テスト: `__tests__/components/timeline/PostList.test.tsx` (既存テストでカバー: status=trashed取得・表示) | P1-TRASH-01,P1-ADP-03 | - | - |
| ☑ | P1-TRASH-03 | 選択チェックボックス（個別/一括） | チェック状態管理。「n件選択中」表示。全選択/部分選択対応。テストでGREEN。実装: `components/timeline/PostList.tsx`（選択状態管理・一括選択UI）、`components/timeline/PostItem.tsx`（個別チェックボックス）、テスト: `__tests__/components/timeline/PostList.test.tsx` (4件GREEN: 一括選択チェックボックス表示・個別選択・一括選択/解除・通常ビューでは非表示) | P1-TRASH-02,P1-UI-06 | - | - |
| ☑ | P1-TRASH-04 | 復元ボタン | 押下でstatus=activeに変更。一覧から消える。通常一覧キャッシュ更新。テストでGREEN。実装: `components/timeline/PostList.tsx`（restoreMutation・復元ボタンUI）、`lib/postRepository.ts`（restore実装済み）、テスト: `__tests__/components/timeline/PostList.test.tsx` (3件GREEN: 復元ボタン表示・restore呼び出し・成功トースト) | P1-TRASH-03,P1-ADP-03 | - | - |
| ☑ | P1-TRASH-05 | 削除ボタン＋確認モーダル | 押下で確認モーダル表示。キャンセル/確定の2パス。削除実行。テストでGREEN。実装: `components/timeline/PostList.tsx`（hardDeleteMutation・削除確認モーダル）、`components/timeline/PostItem.tsx`（ゴミ箱ビューでの削除ボタン）、テスト: `__tests__/components/timeline/PostList.test.tsx` (4件GREEN: 削除ボタンクリックでモーダル表示・キャンセル・削除実行・成功トースト) | P1-TRASH-03,P1-UI-04 | - | - |
| ☑ | P1-TRASH-06 | ゴミ箱を空にする | 一括削除確認モーダル。実行。テストでGREEN。実装: `components/timeline/PostList.tsx`（emptyTrashMutation・一括削除確認モーダル）、`lib/postRepository.ts`（emptyTrash実装）、テスト: `__tests__/components/timeline/PostList.test.tsx` (5件GREEN: ボタン表示・モーダル表示・emptyTrash呼び出し・成功トースト・異なるソートのキャッシュも空になる) | P1-TRASH-05 | - | - |

#### サブフェーズ1-G: エラーハンドリング（主に画面D）

| 状態 | ID | 概要 | 完了条件 | 前提ID | 担当 | 期日 |
| --- | --- | --- | --- | --- | --- | --- |
| ☑ | P1-ERR-01 | 開発用エラーシミュレーション（?errorTest=） | sonnerで各種通知表示（auth/authorization/notfound/validation/server/generic/success）。表示後パラメータ除去。テストでGREEN。実装: `components/landing/AuthenticatedLanding.tsx`（useEffectでerrorTest監視・toast表示・URL除去）、テスト: `__tests__/app/page.test.tsx` (8件GREEN: 各errorTestタイプのトースト表示・URL除去) | P1-UI-05 | - | - |
| ☑ | P1-ERR-02 | 本番環境でのシミュレーション無効化 | `NODE_ENV=production` でスキップ。テストでGREEN。実装: `components/landing/AuthenticatedLanding.tsx`（NODE_ENV=productionガード）、テスト: `__tests__/app/page.test.tsx` (1件GREEN: NODE_ENV=productionで無効化確認) | P1-ERR-01 | - | - |

### フェーズ2

**完了時の到達点**: 本番Google認証・DB接続が完成し、実際に使える状態でデプロイ可能

| 状態 | ID | 概要 | 完了条件 | 前提ID | 担当 | 期日 |
| --- | --- | --- | --- | --- | --- | --- |
| ☐ | P2-DB-01 | DB接続（Prisma + 本番想定DB） | 接続設定が有効でCRUDが実行可能、マイグレーション手順を整備 | P1-ADP-03 | - | - |
| ☐ | P2-CI-01 | CI/デプロイ: migrate deploy + Vercel Deploy Hook | `docs/03. 設計書.md` の方針に従い、main push で GitHub Actions が **差分がある場合のみ** `prisma migrate deploy` を実行し、その後 Vercel Deploy Hook を叩いてデプロイできる。Secrets（例: `DATABASE_DIRECT_URL`, `VERCEL_DEPLOY_HOOK_URL`）の登録先（GitHub Secrets / Vercel env）と運用手順がドキュメント化されている（Runbook: `docs/07. 運用手順（CI・デプロイ）.md`） | P2-DB-01 | - | - |
| ☐ | P2-CI-02 | 環境変数/Secrets運用（local/CI/stg/prod） | `docs/03. 設計書.md` の方針に従い、localは `.env.local`（gitignore）、CIは GitHub Secrets、stg/prod は Vercel Environment Variables に登録する運用が定義され、必要キー（例: `DATABASE_URL` / `DATABASE_DIRECT_URL` / `AUTH_SECRET` / `GOOGLE_CLIENT_ID` / `GOOGLE_CLIENT_SECRET`）の一覧と責務が `docs` に明記されている（Runbook: `docs/07. 運用手順（CI・デプロイ）.md`） | P2-DB-01,P2-AUTH-01 | - | - |
| ☐ | P2-AUTH-01 | Auth.js Route Handlers 本番接続 | Google OAuthでサインイン/アウトし、セッションがUIに反映。スタブCookie/Routeを削除し、本番と同一のセッション基盤に統一してP1-RSK-01で列挙したリスクを根本解消 | P1-ADP-02,P1-RSK-01 | - | - |
| ☐ | P2-DIA-01 | 日記モードトグル（Popover内） | ユーザーアイコンPopoverにトグル追加し、ON/OFFを永続化（本番DB: `User.diaryEnabled`）。テストでGREEN | P2-AUTH-01,P2-DB-01 | - | - |
| ☐ | P2-DIA-02 | 日記モード有効時の表示切替 | 日記ON時のみ「日記」ボタン表示。「すべて」に日記を含む。投稿モードに「日記」選択肢を追加。テストでGREEN | P2-DIA-01 | - | - |
| ☐ | P2-TIM-01 | 手動順ソート | 手動並び替え順でのソートが動作。P2-LIST-01/02完了後に有効化。テストでGREEN | P2-DB-01,P2-LIST-02 | - | - |
| ☐ | P2-NSC-01 | 無限スクロール（Server Actions + TanStack Query） | Prisma + Server Actions でカーソルページングを実装し、`useInfiniteQuery` と連携。Skeleton/全件メッセージ/エラー時のリトライを含むテストがGREEN | P2-DB-01,P1-LIST-10 | - | - |
| ☐ | P2-LIST-01 | 手動並び替え（上下ボタン） | +/-ボタンで1件ずつ移動。md未満でも動作。並び順が本番DBに永続化され、再読込後も維持。テストでGREEN | P2-DB-01,P2-NSC-01 | - | - |
| ☐ | P2-LIST-02 | 手動並び替え（D&D、md以上） | dnd-kitでドラッグ&ドロップ動作。md以上のみ有効。並び順が本番DBに永続化され、再読込後も維持。テストでGREEN | P2-LIST-01 | - | - |
| ☐ | P2-ACC-01 | アカウント削除 | ユーザーデータ削除後セッション終了し、完了メッセージ表示 | P2-AUTH-01,P2-DB-01 | - | - |
| ☐ | P2-TAG-01 | 投稿タグ基本（追加/削除/ラベル編集） | Tag/PostTag スキーマでCRUDを実装し、投稿保存・更新時にタグ配列を永続化。スタブ/本番両方の単体テストがGREEN | P2-DB-01 | - | - |
| ☐ | P2-FLT-03 | タグフィルタUI + クエリ連動 | 表示切替UIから複数タグを選択し、`?tags=` クエリとTanStack Queryキーを同期。タグ変更で一覧が再取得されることをテストでGREEN | P2-TAG-01,P1-FLT-02 | - | - |
| ☐ | P2-TST-01 | 認証/DB/無限スクロール等のテスト拡充 | 設計書テスト戦略の対象がGREEN（統合/E2E含む） | P2-AUTH-01,P2-DB-01 | - | - |

### フェーズ3

| 状態 | ID | 概要 | 完了条件 | 前提ID | 担当 | 期日 |
| --- | --- | --- | --- | --- | --- | --- |
| ☐ | P3-APP-01 | 外観変更（ライト/ダーク/システム・文字サイズ） | テーマ切替UI（system/light/dark）＋文字サイズUI（normal/large/xlarge）が動作し、`User.fontScale` と localStorage に永続化。リロード・再ログイン後も反映し、主要画面の回帰テスト（トースト/モーダル含む）がGREEN | P1-ENV-05,P2-AUTH-01,P2-DB-01 | - | - |

### フェーズ4

| 状態 | ID | 概要 | 完了条件 | 前提ID | 担当 | 期日 |
| --- | --- | --- | --- | --- | --- | --- |
| ☐ | P4-SRCH-01 | テキスト検索（タイトル/本文/モード/タグ） | 入力→検索→一致結果が表示される | P2-DB-01 | - | - |
| ☐ | P4-TAG-02 | カスタムタグ管理 | 追加/編集/削除ができ、削除時に紐づく投稿は「タグ未登録」扱い | P2-TAG-01 | - | - |
| ☐ | P4-LIF-01 | ゴミ箱自動削除 | ゴミ箱滞留期限後に自動削除される | P2-DB-01 | - | - |
| ☐ | P4-EXP-01 | 投稿エクスポート検討/実装 | エクスポート方式を決定し、必要な処理/画面を実装 | P2-DB-01 | - | - |

## 依存関係メモ

### フェーズ1内の依存
- **1-A完了** → 1-B〜1-G着手可能
- **1-B完了** → 1-C〜1-F内のUI実装が加速
- **1-C（認証UI）** → 1-D/1-E/1-Fで認証状態を参照
- **1-D（エディタ）** → 1-E（一覧）の編集ボタンと連携
- **1-F（表示切替）** → 1-E（一覧）のフィルタリングに依存

### フェーズ間の依存
- **フェーズ1の接続ポイント雛形（P1-ADP-01〜03）** がフェーズ2以降の本番接続の前提。
- **認証・DB系テスト（P2-TST-01）** は P2-AUTH-01 / P2-DB-01 完了後に着手。
- **外観変更（フェーズ3: P3-APP-01）** は、フェーズ1のThemeProvider基盤（P1-ENV-05）に加え、必要に応じて認証/DB（P2-AUTH-01 / P2-DB-01）を前提とする。
- **検索・タグ・自動削除などフェーズ4の機能** は、フェーズ2までのCRUD/タグ実装が前提。
