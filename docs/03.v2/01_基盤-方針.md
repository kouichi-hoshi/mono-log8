---
title: 01. 基盤-方針（設計書V2）
source:
author:
  -
published:
created: 2026-01-30
description:
tags:
---

本ファイルは設計書V1（アーカイブ済み）から、基盤方針に関する章を分割したもの。

## この章で決めること

- 開発の前提（TDD/スタブ方針、段階的な実装方針）
- 採用技術・構成の前提（システム構成）
- 対象環境の前提（対象ブラウザ）

## この章の守備範囲

- 開発・実装の進め方（フェーズ）と、プロジェクト全体の前提を扱う
- 個別機能（投稿/タグ/ごみ箱等）の詳細設計は扱わない

## 関連ドキュメント（参照先）

- 設計書V2索引: `docs/03.設計書.v2.md`
- 仕様（ユーザー視点）: `docs/02.仕様書.md`

# 開発・テストの方針

- 依存管理およびスクリプト実行には pnpm（Voltaでバージョン固定）を用いる
- テスト駆動開発で実装する
	    - Red → Green → Refactor
- **日常の開発ではスタブ認証・スタブCRUDを用いて** UI／ロジックを素早く検証する
- 単体・結合・E2Eのテストファイルは、それぞれ実行タイミングや依存関係が異なるので**ファイルを分離**して実装する

---

# 開発・テストの流れ

- **フェーズ1: UIを実装する**
	- 結合テストがしやすいように、接合するUIから優先的に実装する
	- 各UIを実装する際は必ずユニットテストを実装する
		- フェーズ1の単体テストはスタブ・モックを使用する
		- 実装可能な結合テストがあれば都度実装する
	- 単体テスト・結合テストは随時実行する
	- UIの実装が終わったらE2Eテストを実装・実行する
- **フェーズ2: 認証ロジック、データベースを介したCRUD処理を実装する**
	- 単体テストはフェーズ1と同様にテストを実装する
	- 結合テスト・E2Eテストはモック・スタブを介さずに本番同等の環境を構築し実行する

---


# システム構成

- アプリ
    - Next.js v15（Turbopackは使わない、install時のオプションはすべてデフォルトにする）
    - Biome
    - tiptap — 投稿エディタのリッチテキスト入力に使用。投稿本文は tiptap の JSON 形式で DB に保存する
    - prisma
    - dayjs — 投稿の作成日・更新日の日時フォーマット表示に使用（表示フォーマット: `YYYY-MM-DD HH:mm`）
    - TanStack Query — 投稿一覧のキャッシュ・再検証・無限スクロールのデータ取得に使用（詳細は「投稿データ取得・キャッシュ戦略（TanStack Query）」を参照）
- デザインシステム
	- storybook（検討中、初期リリース時は導入しない）
- テスト
    - Jest（単体テスト、結合テスト）
    - Playwright（E2Eテスト）
- UI
    - shadcn/ui
    - tailwindcss
- アイコン
	- https://lucide.dev/
- DB
    - 種類とバージョン: PostgreSQL v17
    - ローカル: ローカル用PostgreSQL
    - 検証用: Neon
    - 本番用: Neon
- 認証
	- Auth.js
- ホスティング
	- Vercel

---

# 可用性・運用

- Vercel + Neon によるホスティング
- Neon の自動スナップショットによるバックアップ

---


## 対象ブラウザ

- サポート対象
  - PC: Chrome / Firefox / Safari / Edge の最新版
  - Mobile: iOS Safari / Android Chrome の最新版
- 方針
  - 仕様上必須の機能（ログイン、投稿作成/編集、モード/ごみ箱切替、無限スクロール、トースト通知）が対象環境で一通り動作することを担保する
  - 特定ブラウザ依存の挙動がある場合は、回避策（CSS/JS）を設計として明記し、E2E/手動確認項目に落とす
