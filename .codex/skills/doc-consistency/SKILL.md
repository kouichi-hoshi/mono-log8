---
name: doc-consistency
description: /docs 配下（要件・仕様・設計・作業計画・UI文言）の整合性を点検し、矛盾/抜け漏れをレポートして（許可後に）最小修正する手順。
---

# doc-consistency

## 目的

- `docs/` 配下の一次資料を相互参照し、**矛盾** と **抜け漏れ** を早期に検知する
- 問題ごとに「影響範囲」「根拠」「修正提案」を揃え、レビューしやすい形で提示する
- 修正は **必ずユーザー許可後** に行い、修正後に再点検して整合を確認する

## 参照ルール（必須）

- ドキュメント参照の優先順位・参照範囲は `AGENTS.md` に従う（必要な章だけ読む）
- 迷ったら「作業計画（チェックリスト含む）」を入口にして、関連箇所へ辿る（ファイル名は変更され得る前提）

## ファイル名が変わる前提（重要）

この skill は `docs/*` の**ファイル名に依存しない**。常に「役割（ドキュメントの種類）」で特定する。

最初に `docs/` を一覧して、以下の役割に対応する“入口ファイル”を **1つずつ** 仮決めし、必要ならユーザーに確認する。

## いつ使うか（When to Use）

- 仕様変更・設計変更・計画変更が入った後に、関連 docs の整合を取り直したいとき
- 「要件にはあるのに設計/計画に無い」「設計の前提が計画に落ちていない」を疑うとき
- チェックリストID（例: `P3-APP-01`）が参照されているのに、定義や完了条件が見つからないとき
- UI 表示文言の期待が散らばっていて、「テキスト・コンテンツ定義」とズレが出てきたとき

## 対象ドキュメント（役割ベース）

- 要件（要求/要件定義）: 例「要件定義」「要求」「スコープ」「受け入れ条件」
- 仕様（仕様書）: 例「仕様」「画面挙動」「URL」「状態」「ルール」
- 設計（設計書）: 例「設計」「アーキテクチャ」「状態管理」「テスト戦略」
- 作業計画（計画書/チェックリスト）: 例「作業計画」「フェーズ」「Done」「チェックリスト」
- UI文言（テキスト/コンテンツ定義）: 例「文言」「トースト」「アラート」「ラベル」

### 役割の特定方法（推奨）

ファイル名が揺れている場合は、以下で“中身”から特定する（例コマンド）。

- `docs/` を列挙: `ls -la docs`
- タイトル/見出しで絞る: `rg -n \"^#\" docs`
- キーワードで候補抽出: `rg -l \"(要件定義|要求|受け入れ条件)\" docs`
- チェックリスト入口: `rg -l \"チェックリスト\" docs`
- UI文言入口: `rg -l \"(トースト|アラート|文言|コンテンツ定義)\" docs`

## 成果物（Outputs）

- 整合性チェックレポート（問題ごとの表）
- （許可が出た場合のみ）docs の最小修正パッチ
- 修正後の再点検結果（矛盾が解消したか、残課題は何か）

## 手順（Workflow）

### 0) スコープを確定する（最初に聞く）

以下を 1〜3 行で確定する（不明ならユーザーに質問する）。

- 対象: どの機能/フェーズ/画面/ID（例: `P3-*`）の整合性か
- 期待するアウトプット: レポートのみか、許可があれば修正までか

### 1) 入口（Single Source of Truth）を決めて最小読みにする

- まず「作業計画（チェックリスト含む）」の該当フェーズ/チェックリストを特定する
- そこに紐づく「参照先」（要件/仕様/設計/UI文言）だけを読む

### 2) “主張（Claims）” を抽出して対応付ける

各ドキュメントから、次を **箇条書きで短く** 抜き出して対応付ける。

- 要件/仕様: ユーザーができること、制約、受け入れ条件、画面/URL/状態
- 設計: 実装前提、技術要件、非機能、テスト戦略、チェックリストID参照
- 作業計画: タスク、完了条件（Done）、フェーズ境界、チェックリストIDの定義
- UI文言: 表示文字列、アラート/トースト文言、表記ゆれのルール

### 3) 不整合を分類する（検知観点）

- **欠落**: 要件/仕様にあるのに設計や作業計画に無い
- **未反映**: 設計の前提（技術/非機能/テスト要件）が作業計画に落ちていない
- **不一致**: 要件/仕様/設計で内容が食い違う（挙動、用語、URL、状態遷移など）
- **ID不整合**: 設計が参照するチェックリストIDが計画側に存在しない/説明が薄い
- **文言不整合**: 仕様/設計にあるUI文言が「UI文言（テキスト・コンテンツ定義）」と一致しない、または未定義

### 4) レポートを書く（必須フォーマット）

問題ごとに、次を揃えて列挙する。

- 影響範囲: どの画面/導線/フェーズ/テストに影響するか
- 根拠: 該当ファイル名＋該当箇所の要約（長文引用は避ける）
- 修正提案: どの doc をどう直すのが最小か（案は 1〜2 個に絞る）
- 判断が必要な点: 仕様の真実が決めきれない場合の質問

### 5) 修正はユーザー許可後にだけ行う

- 修正案を提示して、**どの案で直すか** をユーザーに選んでもらう
- 許可が出たら、docs を **最小差分** で修正する（無関係な整形/改稿はしない）
- 修正後、同じ観点で再点検し「解消/未解消/新規発見」を更新する

## テンプレ（コピペ用）

### 整合性チェックレポート（最小）

```text
対象スコープ:
参照した一次資料:

No | 分類 | 影響範囲 | 根拠（ファイル/要約） | 修正提案 | 要判断（質問）
---|------|----------|------------------------|----------|---------------
1  |      |          |                        |          |
```

## 注意事項（安全・運用）

- `AGENTS.md` の禁止事項（DB操作/マイグレーション等）に抵触する提案はしない
- 修正前に「どの docs を真実とするか」が揺れる場合は、先に質問して確定する
